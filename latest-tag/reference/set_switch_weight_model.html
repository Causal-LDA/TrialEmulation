<!DOCTYPE html>
<!-- Generated by pkgdown + https://github.com/insightsengineering/r-pkgdown-multiversion -->
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Set switching weight model — set_switch_weight_model • TrialEmulation</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Set switching weight model — set_switch_weight_model">
<meta name="description" content="">
<meta property="og:description" content="">
<meta property="og:image" content="https://causal-lda.github.io/TrialEmulation/logo.svg">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">TrialEmulation</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.4.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Getting-Started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/new-interface.html">New Interface</a></li>
    <li><a class="dropdown-item" href="../articles/Extending-TrialEmulation.html">Extending TrialEmulation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      <div><li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-versions">Versions</a>
    <div class="dropdown-menu" aria-labelledby="dropdown-versions">
    <a class="dropdown-item" data-toggle="tooltip" title="" href="https://Causal-LDA.github.io/TrialEmulation/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://Causal-LDA.github.io/TrialEmulation/v0.0.4.2">v0.0.4.2</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://Causal-LDA.github.io/TrialEmulation/v0.0.4.1">v0.0.4.1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://Causal-LDA.github.io/TrialEmulation/v0.0.4.0">v0.0.4.0</a>
</div>
</li></div>
</ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Causal-LDA/TrialEmulation/" aria-label="github"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Set switching weight model</h1>
      <small class="dont-index">Source: <a href="https://github.com/Causal-LDA/TrialEmulation/blob/v0.0.4.2/R/trial_sequence.R" class="external-link"><code>R/trial_sequence.R</code></a></small>
      <div class="d-none name"><code>set_switch_weight_model.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a>
</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">set_switch_weight_model</span><span class="op">(</span><span class="va">object</span>, <span class="va">numerator</span>, <span class="va">denominator</span>, <span class="va">model_fitter</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'trial_sequence'</span></span>
<span><span class="fu">set_switch_weight_model</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">numerator</span>,</span>
<span>  <span class="va">denominator</span>,</span>
<span>  <span class="va">model_fitter</span>,</span>
<span>  eligible_wts_0 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  eligible_wts_1 <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'trial_sequence_ITT'</span></span>
<span><span class="fu">set_switch_weight_model</span><span class="op">(</span><span class="va">object</span>, <span class="va">numerator</span>, <span class="va">denominator</span>, <span class="va">model_fitter</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a>
</h2>


<dl>
<dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a>
</dt>
<dd><p>A <a href="trial_sequence.html">trial_sequence</a> object.</p></dd>


<dt id="arg-numerator">numerator<a class="anchor" aria-label="anchor" href="#arg-numerator"></a>
</dt>
<dd><p>Right hand side formula for the numerator model</p></dd>


<dt id="arg-denominator">denominator<a class="anchor" aria-label="anchor" href="#arg-denominator"></a>
</dt>
<dd><p>Right hand side formula for the denominator model</p></dd>


<dt id="arg-model-fitter">model_fitter<a class="anchor" aria-label="anchor" href="#arg-model-fitter"></a>
</dt>
<dd><p>A <a href="te_model_fitter-class.html">te_model_fitter</a> object, such as <a href="stats_glm_logit.html">stats_glm_logit</a></p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a>
</dt>
<dd><p>Other arguments used by methods.</p></dd>


<dt id="arg-eligible-wts-">eligible_wts_0<a class="anchor" aria-label="anchor" href="#arg-eligible-wts-"></a>
</dt>
<dd><p>Name of column containing indicator (0/1) for observation to be excluded/included in weight
model.</p></dd>


<dt id="arg-eligible-wts-">eligible_wts_1<a class="anchor" aria-label="anchor" href="#arg-eligible-wts-"></a>
</dt>
<dd><p>Exclude some observations when fitting the models for the inverse probability of treatment
weights. For example, if it is assumed that an individual will stay on treatment for at least 2 visits, the first 2
visits after treatment initiation by definition have a probability of staying on the treatment of 1.0 and should
thus be excluded from the weight models for those who are on treatment at the immediately previous visit. Users can
define a variable that indicates that these 2 observations are ineligible for the weight model for those who are on
treatment at the immediately previous visit and add the variable name in the argument <code>eligible_wts_1</code>. Similar
definitions are applied to <code>eligible_wts_0</code> for excluding observations when fitting the models for the inverse
probability of treatment weights for those who are not on treatment at the immediately previous visit.</p></dd>

</dl>
</div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a>
</h2>
    <p><code>object</code> is returned with <code>@switch_weights</code> set</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a>
</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="trial_sequence.html">trial_sequence</a></span><span class="op">(</span><span class="st">"PP"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="set_data.html">set_data</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_censored</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">set_switch_weight_model</span><span class="op">(</span></span></span>
<span class="r-in"><span>    numerator <span class="op">=</span> <span class="op">~</span> <span class="va">age_s</span> <span class="op">+</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x3</span>,</span></span>
<span class="r-in"><span>    denominator <span class="op">=</span> <span class="op">~</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span>,</span></span>
<span class="r-in"><span>    model_fitter <span class="op">=</span> <span class="fu"><a href="stats_glm_logit.html">stats_glm_logit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Trial Sequence Object </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimand: Per-protocol </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - N: 321 observations from 89 patients </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         id period treatment    x1           x2    x3        x4   age      age_s</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      &lt;int&gt;  &lt;int&gt;     &lt;num&gt; &lt;num&gt;        &lt;num&gt; &lt;int&gt;     &lt;num&gt; &lt;num&gt;      &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1:     1      0         1     1  1.146148362     0 0.7342030    36 0.08333333</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   2:     1      1         1     1  0.002200337     0 0.7342030    37 0.16666667</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ---                                                                           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 320:    99      1         1     0 -1.106480738     1 0.5752681    66 2.58333333</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 321:    99      2         0     0  1.650478074     1 0.5752681    67 2.66666667</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      outcome censored eligible time_on_regime</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        &lt;num&gt;    &lt;int&gt;    &lt;num&gt;          &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1:       0        0        1              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   2:       0        0        0              1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ---                                         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 320:       0        0        0              1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 321:       0        0        0              2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> IPW for informative censoring: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - No weight model specified </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> IPW for treatment switch censoring: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Numerator formula: treatment ~ age_s + x1 + x3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Denominator formula: treatment ~ x3 + x4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Model fitter type: te_stats_glm_logit </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Weight models not fitted. Use calculate_weights() </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sequence of Trials Data: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Use set_expansion_options() and expand_trials() to construct the sequence of trials dataset. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Outcome model: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Outcome model not specified. Use set_outcome_model() </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Isaac Gravestock, Li Su, Roonak Rezvani, Julia Moesch, Medical Research Council (MRC), F. Hoffmann-La Roche AG.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
